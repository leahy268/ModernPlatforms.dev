---
title: Testing IAC (Bicep) with Microsoft Symphony
category: Cloud Automation
heroImg: /uploads/TestingBicep2.png
excerpt: >
  Testing IAC is always a problem. Waiting for a full deployment to occur before
  discovering bugs is a time-consuming process. Using Microsoft Symphony, we can
  validate Bicep code early and avoid unnecessary delays.
author: content/authors/warwick.md
date: 2025-05-15T10:00:00.000Z
---

## 🧪 Why Test Bicep with Microsoft Symphony?

Infrastructure as Code (IaC) brings automation and consistency to cloud deployments, but testing can be a challenge. Bicep — Microsoft’s domain-specific language for Azure Resource Manager — simplifies infrastructure definitions. However, without proper validation, teams often encounter deployment issues that could have been caught earlier.

**This is where Microsoft Symphony shines.**  
Symphony orchestrates and executes workflows that automate validation, testing, and deployment of Bicep templates. Instead of waiting for a full deployment, you can run pre-deployment checks, validate parameters, and ensure everything is working before merging changes.

---

## ⚙️ Setting Up Symphony for Bicep Testing

### 1. Install Symphony and Dependencies

To get started, clone the Symphony repository and follow the setup instructions:

**Getting Started Guide**: https://github.com/microsoft/symphony/blob/main/docs/GETTING_STARTED.md

> 💡 On Windows, using **WSL** is recommended for ease of setup.

```bash
# Clone the Symphony repo
git clone https://github.com/microsoft/symphony.git && cd symphony

# Login to Azure
az login

# Set the target subscription
az account set --subscription <TargetSubscriptionId>

# Source the CLI setup
source setup.sh

# Deploy Symphony dependencies
symphony provision

# Configure the orchestrator (GitHub or Azure DevOps, with Bicep or Terraform)
symphony pipeline config <azdo|github> <terraform|bicep>
```

During setup, you’ll be prompted for:
- GitHub org and repo name  
- Whether the repo should be private  
- Whether to deploy private runners (**recommended**)  
- Resource group and subnet ID for runners  
- GitHub PAT for configuring secrets  
- Whether to install sample workflows (**yes!**)

> 🛡️ **Tip:** Installing private runners provides a safer space to test, especially if any secrets are accidentally exposed. GitHub-hosted runners had minor compatibility issues for me during setup.

---

## 🧪 PR Workflow: `workflow.pr.bicep.yaml`

This workflow is triggered when a **pull request to `main`** is opened, updated, or reopened. It automatically spins up a **temporary environment** to test infrastructure
